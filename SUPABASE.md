# Supabase Integration for Inspix

This project has been set up with Supabase integration for authentication and data storage. Below you'll find information on the setup and usage.

## Setup

The following packages have been installed:
- `@supabase/supabase-js`: The Supabase JavaScript client
- `expo-secure-store`: For secure storage of auth tokens on mobile devices
- `react-native-url-polyfill`: Provides URL compatibility for React Native

## Configuration

The Supabase configuration is stored in the `.env` file with the following variables:
- `EXPO_PUBLIC_SUPABASE_URL`: Your Supabase project URL
- `EXPO_PUBLIC_SUPABASE_ANON_KEY`: Your Supabase anonymous key

## Structure

1. **Authentication**
   - `lib/supabase.ts`: Sets up the Supabase client with secure storage
   - `context/AuthContext.tsx`: Provides authentication context and hooks
   - `components/AuthExample.tsx`: Example component for sign up, sign in, and sign out

2. **Data Operations**
   - `hooks/useSupabase.ts`: Custom hooks for Supabase data operations:
     - `useSupabaseQuery`: For fetching data
     - `useSupabaseInsert`: For inserting data
     - `useSupabaseUpdate`: For updating data
     - `useSupabaseDelete`: For deleting data

3. **Example**
   - `components/SupabaseDataExample.tsx`: Example todo list using Supabase

## Usage

### Authentication

```tsx
import { useAuth } from '@/context/AuthContext';

// In your component
const { session, signIn, signUp, signOut, isLoading } = useAuth();

// Check if user is signed in
if (session) {
  const userId = session.user.id;
  // User is signed in
} else {
  // User is not signed in
}

// Sign in
const { error } = await signIn('user@example.com', 'password');

// Sign up
const { error } = await signUp('user@example.com', 'password');

// Sign out
await signOut();
```

### Data Operations

```tsx
import { useSupabaseQuery, useSupabaseInsert, useSupabaseUpdate, useSupabaseDelete } from '@/hooks/useSupabase';

// Fetch data
const { data, loading, error } = useSupabaseQuery(
  'table_name',
  (query) => query.eq('column', 'value').order('created_at', { ascending: false }),
  [dependencyArray]
);

// Insert data
const { insert, loading } = useSupabaseInsert('table_name');
const { data, error } = await insert({ column1: 'value1', column2: 'value2' });

// Update data
const { update, loading } = useSupabaseUpdate('table_name');
const { data, error } = await update({ column1: 'new_value' }, { id: 123 });

// Delete data
const { remove, loading } = useSupabaseDelete('table_name');
const { error } = await remove({ id: 123 });
```

## Database Setup

For the Todo list example to work, create a table in your Supabase database:

```sql
CREATE TABLE todos (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  task TEXT NOT NULL,
  is_complete BOOLEAN NOT NULL DEFAULT FALSE,
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Enable RLS (Row Level Security)
ALTER TABLE todos ENABLE ROW LEVEL SECURITY;

-- Create policy to enable users to see only their own todos
CREATE POLICY "Users can only access their own todos" 
ON todos FOR ALL 
USING (auth.uid() = user_id);
```

## Next Steps

1. Create additional tables in your Supabase database
2. Build more complex queries using the Supabase client
3. Add real-time subscriptions for live updates
4. Implement file storage using Supabase Storage
